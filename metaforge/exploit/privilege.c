
#include <windows.h>
#include <winternl.h>

typedef struct _TokenPrivileges {
    HANDLE token;
    DWORD privileges;
} TokenPrivileges;

__declspec(dllexport) BOOL __stdcall EnablePrivilege(LPCSTR privilegeName) {
    HANDLE token;
    HANDLE process = GetCurrentProcess();
    
    if (!OpenProcessToken(process, TOKEN_ALL_ACCESS, &token)) {
        return FALSE;
    }
    
    LUID luid;
    if (!LookupPrivilegeValueA(NULL, privilegeName, &luid)) {
        CloseHandle(token);
        return FALSE;
    }
    
    TOKEN_PRIVILEGES tp;
    tp.PrivilegeCount = 1;
    tp.Privileges[0].Luid = luid;
    tp.Privileges[0].Attributes = SE_PRIVILEGE_ENABLED;
    
    BOOL result = AdjustTokenPrivileges(token, FALSE, &tp, sizeof(TOKEN_PRIVILEGES), NULL, NULL);
    DWORD error = GetLastError();
    
    CloseHandle(token);
    return result && error == ERROR_SUCCESS;
}

__declspec(dllexport) BOOL __stdcall ElevateProcess(void) {
    return EnablePrivilege("SeDebugPrivilege");
}
